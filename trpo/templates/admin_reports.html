<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–û—Ç—á–µ—Ç—ã –ø–æ –∑–∞—è–≤–∫–∞–º ‚Äî Coworking</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <a href="{{ url_for('index') }}" class="logo">Coworking Admin</a>
        <nav>
          <a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="{{ url_for('admin_panel') }}">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
          <a href="{{ url_for('admin_reports_bookings') }}" class="active">–û—Ç—á–µ—Ç—ã –ø–æ –∑–∞—è–≤–∫–∞–º</a>
          <a href="{{ url_for('admin_reports_availability') }}">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</a>
          <a href="{{ url_for('admin_users') }}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
          <a href="{{ url_for('bookings_view') }}">–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
          <a href="{{ url_for('logout') }}">–í—ã—Ö–æ–¥</a>
        </nav>
        <div class="user-info">
          üëë {{ user.username }} (–ê–¥–º–∏–Ω)
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <h1>–û—Ç—á–µ—Ç—ã –ø–æ –∑–∞—è–≤–∫–∞–º</h1>
      <p class="page-description">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫ –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="filters">
      <form method="GET" action="{{ url_for('admin_reports_bookings') }}">
        <div class="filter-group">
          <div class="filter-item">
            <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
            <input type="date" id="start_date" name="start_date" value="{{ start_date }}" required>
          </div>
          
          <div class="filter-item">
            <label for="end_date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
            <input type="date" id="end_date" name="end_date" value="{{ end_date }}" required>
          </div>
          
          <div class="filter-item">
            <button type="submit" class="btn btn-primary">
              üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
            </button>
            <a href="{{ url_for('admin_reports_bookings') }}" class="btn btn-outline">
              üîÑ –°–±—Ä–æ—Å–∏—Ç—å
            </a>
          </div>
        </div>
      </form>
    </div>

    <!-- –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">–°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div class="card-subtitle">
          –ü–µ—Ä–∏–æ–¥: {{ start_date }} ‚Äî {{ end_date }}
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìã</div>
          <div class="stat-value">{{ bookings|length }}</div>
          <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-value">
            {% set unique_users = [] %}
            {% for booking in bookings %}
              {% if booking[5] not in unique_users %}
                {% set _ = unique_users.append(booking[5]) %}
              {% endif %}
            {% endfor %}
            {{ unique_users|length }}
          </div>
          <div class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
      </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h2>
        <div class="card-subtitle">
          {{ bookings|length }} –∑–∞—è–≤–æ–∫ –Ω–∞–π–¥–µ–Ω–æ
        </div>
      </div>
      
      {% if bookings %}
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>–¢–∏–ø –ø–æ–º–µ—â–µ–Ω–∏—è</th>
                <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</th>
                <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                <th>–ï–¥–∏–Ω–∏—Ü–∞</th>
              </tr>
            </thead>
            <tbody>
              {% for booking in bookings %}
              <tr>
                <td>#{{ booking[0] }}</td>
                <td>{{ booking[5] }}</td>
                <td>
                  {% if booking[1] == 'workspace_open' %}–û—Ç–∫—Ä—ã—Ç–æ–µ —Ä–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ
                  {% elif booking[1] == 'office_light' %}–ö–∞–±–∏–Ω–µ—Ç ¬´–õ–∞–π—Ç¬ª
                  {% elif booking[1] == 'office_premium' %}–ö–∞–±–∏–Ω–µ—Ç ¬´–ü—Ä–µ–º–∏—É–º¬ª
                  {% elif booking[1] == 'meeting_room' %}–ü–µ—Ä–µ–≥–æ–≤–æ—Ä–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞
                  {% else %}{{ booking[1] }}{% endif %}
                </td>
                <td>{{ booking[2] }}</td>
                <td>{{ booking[4] }}</td>
                <td>
                  {% if booking[3] == 'days' %}
                    <span class="status-badge">–î–Ω–∏</span>
                  {% else %}
                    <span class="status-badge">–ß–∞—Å—ã</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üîç</div>
          <h3>–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
          <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
        </div>
      {% endif %}
    </div>
  </main>

  <script>
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date().toISOString().split('T')[0];
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const weekAgoStr = weekAgo.toISOString().split('T')[0];
      
      if (!document.getElementById('start_date').value) {
        document.getElementById('start_date').value = weekAgoStr;
      }
      if (!document.getElementById('end_date').value) {
        document.getElementById('end_date').value = today;
      }
    });
  </script>
  
  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>